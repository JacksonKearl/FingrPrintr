<!DOCTYPE html>
<html lang="en">

<head></head>

<body id="index">
    <h1>FingrPrintr</h1>
    <h2>The Internet's Loneliest Social Network</h2>
    <form method="post">
        <div class="input-line">
            Fingerprint
            <br />
            <input id="fp" size="34" type="text" name="fingerprint" readonly value="%FINGERPRINT%" />
        </div>
        <div class="input-line">
            Display Name
            <br />
            <input id="name" type="text" name="username" required minlength="5" maxlength="32" size="30"
                pattern="[a-zA-Z0-9][a-zA-Z0-9 ]*" value="%USERNAME%" />
        </div>
        <input id="chatButton" type="submit" autofocus value="Let's Chat!" />
    </form>
</body>

<script type="module">
    import { FingerprintJS } from './fingrprintr.js'

    (async () => {
        const button = document.getElementById('chatButton')
        const fpEl = document.getElementById('fp')
        const browserPrint = fpEl.value

        try {
            button.disabled = true
            fpEl.value = 'loading...'
            const fp = await FingerprintJS.getFingerprint()
            fpEl.value = fp
        } catch (e) {
            console.error(e)
            fpEl.value = browserPrint
        }

        button.disabled = false
    })()
</script>

</html>